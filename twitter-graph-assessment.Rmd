---
title: "Análisis de Grafos y Redes Sociales"
author: "José Vicente Mellado"
date: "15 February 2017"
output: html_document
---

## Introducción

El	 grafo	 out.ego-twitter almacena	 información	 acerca	 de	 usuarios	 de	 Twitter.	 En	 concreto,	 se	 trata	 de	 un	grafo	 dirigido	 no	 ponderado	 donde	 cada	 vértice	 representa	a	 un	usuario,	mientras	que	una	arista	(v, u) indica	que	el	usuario	v sigue	al	usuario	u. El	objetivo	 de	 esta	 hoja	 de	 ejercicios	 es	 analizar	 la	 estructura	 de	 este	 grafo	 y	 extraer	 diferentes	características	estructurales	del	mismo.

```{r import-libraries, message=FALSE, warning=FALSE}
library(igraph)
library(magrittr)
library(knitr)
library(dplyr)
```

1. Carga el grafo en memoria. Las funciones read_table y graph.data.frame facilitan la tarea de cargar grafos en un formato aceptado por igraph. Busca en la documentación de igraph y R su descripción y uso.

```{r 1}
g <- read.table('./out.ego-twitter', sep=' ') %>%
                graph_from_data_frame(directed=TRUE)
```

2. Muestra	 el	 grafo	 por	 pantalla e	 indica	 qué	 tipo	 de	 grafo	 es.	 ¿Es	 de	 ayuda	 la	 visualización	del	grafo para	identificar	su	tipo?

```{r 2}
#plot(g, layout=layout.kamada.kawai)

cat('¿Es el grafo conexo?: ',is.connected(g), '\n')
cat('¿Es el grafo dirigido?: ', is.directed(g), '\n')
cat('¿Es el grafo ponderado?: ', is.weighted(g), '\n')
cat('¿Es el grafo bipartido?: ', is.bipartite(g), '\n')
```

La información que nos muestra la salida sobre el grafo es la siguiente: se trata de un grafo que no es conexo, sí es dirigido, no es un grafo ponderado ni tampoco bipartido.


3. ¿Qué	 representa,	 en	 este	 grafo,	 el	 grado	 de	 un	 vértice?	 Analiza y	 comenta	 la	distribución	del	grado	de	este	grafo.


El grado de un vértice representa el número de seguidores (followers) y perfiles que sigue (follows) de un usuario.

Al tratarse de un grafo dirigido, es interesante ver el grado de entrada (seguidores) y de salida (seguidos) de cada nodo (usuario).

```{r 3-in}
g.degree.in <- degree(g, mode='in')

hist(g.degree.in, labels=TRUE)
```

En este caso estamos viendo la frecuencia de seguidores. Se puede apreciar que hay muchos usuarios con 5 o menos seguidores en comparación con el resto.

```{r 3-out}
g.degree.out <- degree(g, mode='out')

hist(g.degree.out, labels=TRUE)
```

En este caso estamos viendo la frecuencia de perfiles seguidos. Se puede apreciar que hay muchos usuarios que siguen a 20 o menos perfiles en comparación con el resto.


4. Si	seleccionamos	la	comunidad	 formada	por	los	usuarios	190,	191,	192,	193,	194	y	13167,	 ¿podemos	 considerar	 que	 los	 usuarios	 que	 la	 forman	 están	 fuertemente	conectados?	¿qué	tipo	de	conexión	tienen?

```{r 4}
community <- induced_subgraph(g, c('190', '191', '192', '193', '193', '194', '13167'))

plot(community)

cat('¿Es el grafo fuertemente conexo?: ', is_connected(community, mode='strong'), '\n')
cat('¿Es el grafo débilmente conexo?: ', is_connected(community, mode='weak'), '\n')

cat('Densidad del grafo: ', graph.density(g)*100, '%', '\n')
cat('Reciprocidad del grafo: ', reciprocity(g, mode="default")*100, '%', '\n')
```

La comunidad no forma un grafo fuertemente conexo, por lo que no es posible visitar todos los perfiles a partir del conjunto de perfiles que sigue (follows) cada usuario. No están fuertemente conectados los miembros de la comunidad.

Sin embargo, sí tienen una conexión débil: Es decir, si no se tuviera en cuenta el sentido de las aristas, se podrían visitar todos los perfiles a partir del conjunto de perfiles que sigue (follows) cada usuario. 

Además no es prácticamente nada denso, y como se puede apreciar la reciprocidad tampoco es alta (a penas del 1.63%).


5. ¿Qué	 usuario	 tiene	 más	 seguidores?	 ¿Qué	 usuario	 sigue	 a	 un	 mayor	 número	 de	usuarios?

```{r 5}
cat('Usuario con más seguidores: \n')
sort(g.degree.in, decreasing=TRUE)[1]

cat('Usuario que más perfiles sigue: \n')
sort(g.degree.out, decreasing=TRUE)[1]
```

El usuario con más seguidores es el 36, con 57 followers.

El usuario que más perfiles sigue es el 11824, con 238 follows.


6. Indica	quiénes	son	los	seguidores	del	usuario	1305.

```{r 6}
in_node <- '1305'

in_neighbors <- neighbors(g, in_node, mode='in')

in_neighbors

in_neighbors %>%
  as_ids(.) %>%
  c(., in_node) %>%
  induced_subgraph(g, .) %>%
  plot(.)
```

Los seguidores del usuario 1305 son los usuarios 1301, 7331, 13200 y 16843.


7. Indica	a	quién	sigue	el	usuario	1373.

```{r 7}
out_node <- '1373'

out_neighbors <- neighbors(g, out_node, mode='out')

cat('Lista de perfiles que sigue el usuario 1373: \n')
out_neighbors


out_neighbors %>%
  as_ids(.) %>%
  c(., out_node) %>%
  induced_subgraph(g, .) %>%
  plot(., edge.arrow.size=0.5, edge.arrow.width=0.5)
```

Los seguidores del usuario 1373 son los que se indican en la lista anterior.


8. ¿Cuál	es	el	ratio	seguidores/siguiendo	del	usuario	13815? ¿se	puede	considerar	que	es	un	usuario	influyente?

```{r 8}
ex_8_node <- '13815'

followers <- length(neighbors(g, ex_8_node, mode='in'))
follows <- length(neighbors(g, ex_8_node, mode='out'))

cat('Followers: ', followers, '\n')
cat('Follows: ', follows, '\n')
followers/follows

#sort(authority_score(g, scale = TRUE)$vector, decreasing = TRUE)[ex_8_node]
authority_score(g, scale = TRUE)$vector[ex_8_node]
```

El ratio es de 1 seguidor por 9 perfiles seguidos. No parece que sea un usuario influyente porque sigue a mucha más gente de la que a él le sigue. 

Además, el authority score del usuario es muy bajo incluso comparándolo con el score de otros perfiles (ejecutar línea comentada).


9. ¿Podemos	 decir	 que	 el	 grafo	 representa	 una	 gran	 comunidad? ¿O	 existen	comunidades	 aisladas?	 Indica	 la	 comunidad	 o	 comunidades	 que	 encuentras	 en	 el	grafo.

```{r 9}
#edge.betweenness.community(g)
```

